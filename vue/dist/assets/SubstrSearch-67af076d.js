import{c as s,A as ze,d as Me,r as k,o as De,c7 as X,m as Fe,B as Ve,ax as Be,y as Ue,z as Ee,C as Y,c8 as He,$ as Pe,S as g,T as A,a1 as t,a2 as e,U as u,V as i,W as o,a0 as b,Y as h,a3 as V,cj as Te,ae as R,a4 as Z,J as Ge,ad as Ne,X as je,R as ee,ah as Je,ai as te,cc as Ke,ag as Le,aN as qe,aO as We,ck as Qe,ce as Xe,Z as Ye}from"./index-291103b4.js";import{S as Ze}from"./index-99a11040.js";/* empty css              */import"./index-a2b6d909.js";import{c as et,d as tt,F as st}from"./FileItem-05696d6c.js";import{_ as at,L as lt,R as nt,f as ot}from"./MultiSelectKeep-b801971c.js";import{c as it,u as rt}from"./hook-8fcf40ff.js";import{f as O,H as se,_ as dt,a as ut}from"./searchHistory-2f8bea86.js";import"./functionalCallableComp-33cd562d.js";/* empty css              */import"./_isIterateeCall-e0eaeb93.js";import"./index-2541210c.js";import"./shortcut-9b128798.js";import"./Checkbox-12aa1d4b.js";import"./index-89cb307c.js";import"./useGenInfoDiff-7fd793c7.js";var ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const pt=ct;function ae(c){for(var p=1;p<arguments.length;p++){var d=arguments[p]!=null?Object(arguments[p]):{},f=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(d).filter(function(_){return Object.getOwnPropertyDescriptor(d,_).enumerable}))),f.forEach(function(_){ft(c,_,d[_])})}return c}function ft(c,p,d){return p in c?Object.defineProperty(c,p,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[p]=d,c}var B=function(p,d){var f=ae({},p,d.attrs);return s(ze,ae({},f,{icon:pt}),null)};B.displayName="AimOutlined";B.inheritAttrs=!1;const vt=B,gt="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",U=c=>(qe("data-v-127e6fd2"),c=c(),We(),c),mt={style:{"padding-right":"16px"}},_t=U(()=>u("div",null,null,-1)),ht=["title"],yt=["src"],bt={class:"search-bar"},kt={class:"form-name"},wt={class:"search-bar last actions"},St={class:"hint"},Ct={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},xt={style:{margin:"16px 32px 16px"}},It={style:{"padding-right":"16px"}},$t=U(()=>u("div",null,null,-1)),At=U(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),Rt={key:2,class:"preview-switch"},Ot=Me({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(c){const p=c,d=k(!1),f=k(""),_=k(!1),w=k(p.searchScope??""),C=k(!1),E=k(0),z=it(l=>{const a={cursor:l,regexp:d.value?f.value:"",surstr:d.value?"":f.value,path_only:_.value,folder_paths:(w.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r)};return Qe(a)}),{queue:S,images:m,onContextMenuClickU:H,stackViewEl:le,previewIdx:x,previewing:P,onPreviewVisibleChange:ne,previewImgMove:T,canPreview:G,itemSize:N,gridItems:oe,showGenInfo:I,imageGenInfo:j,q:ie,multiSelectedIdxs:M,onFileItemClick:re,scroller:J,showMenuIdx:D,onFileDragStart:de,onFileDragEnd:ue,cellWidth:ce,onScroll:K,saveAllFileAsJson:pe,saveLoadedFileAsJson:fe,props:ve,changeIndchecked:ge,seedChangeChecked:me,getGenDiff:_e,getGenDiffWatchDep:he}=rt(z),v=k();De(async()=>{v.value=await X(),v.value.img_count&&v.value.expired&&await L(),p.searchScope&&await $()}),Fe(()=>p,async l=>{ve.value=l},{deep:!0,immediate:!0});const L=Ve(()=>S.pushAction(async()=>(await Xe(),v.value=await X(),v.value)).res),q=l=>{f.value=l.substr,w.value=l.folder_paths_str,d.value=l.isRegex,C.value=!1,$()},$=async()=>{E.value++,O.value.add({substr:f.value,folder_paths_str:w.value,isRegex:d.value}),await z.reset({refetch:!0}),await Be(),K(),J.value.scrollToItem(0),m.value.length||Ue.info(Ee("fuzzy-search-noResults"))};Y("returnToIIB",async()=>{const l=await S.pushAction(He).res;v.value.expired=l.expired}),Y("searchIndexExpired",()=>v.value&&(v.value.expired=!0));const ye=()=>{d.value=!d.value},be=Pe(),{onClearAllSelected:ke,onSelectAll:we,onReverseSelect:Se}=et();return(l,a)=>{const r=dt,y=ut,Ce=ee,xe=Je,W=te,Ie=Ke,F=te,$e=Le,Ae=ee,Re=Ze;return g(),A(je,null,[s(Ce,{visible:C.value,"onUpdate:visible":a[0]||(a[0]=n=>C.value=n),width:"70vw","mask-closable":"",onOk:a[1]||(a[1]=n=>C.value=!1)},{default:t(()=>[s(se,{records:e(O),onReuseRecord:q},{default:t(({record:n})=>[u("div",mt,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(g(),b(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):h("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),_t])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:le},[s(at,{show:!!e(M).length||e(be).keepMultiSelect,onClearAllSelected:e(ke),onSelectAll:e(we),onReverseSelect:e(Se)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),v.value?(g(),A("div",{key:0,class:"search-bar",onKeydown:a[6]||(a[6]=V(()=>{},["stop"]))},[s(xe,{value:f.value,"onUpdate:value":a[2]||(a[2]=n=>f.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(S).isIdle,onKeydown:Te($,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),u("div",{class:R(["regex-icon",{selected:_.value}]),onKeydown:a[3]||(a[3]=V(()=>{},["stop"])),onClick:a[4]||(a[4]=n=>_.value=!_.value),title:l.$t("pathOnly")},[s(e(vt))],42,ht),u("div",{class:R(["regex-icon",{selected:d.value}]),onKeydown:a[5]||(a[5]=V(()=>{},["stop"])),onClick:ye,title:"Use Regular Expression"},[u("img",{src:e(gt)},null,8,yt)],34),v.value.expired||!v.value.img_count?(g(),b(W,{key:0,onClick:e(L),loading:!e(S).isIdle,type:"primary"},{default:t(()=>[i(o(v.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(g(),b(W,{key:1,type:"primary",onClick:$,loading:!e(S).isIdle||e(z).loading,disabled:!f.value&&!w.value},{default:t(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading","disabled"]))],32)):h("",!0),u("div",bt,[u("div",kt,o(l.$t("searchScope")),1),s(Ie,{"auto-size":{maxRows:8},value:w.value,"onUpdate:value":a[7]||(a[7]=n=>w.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",wt,[e(m).length?(g(),b(F,{key:0,onClick:e(fe)},{default:t(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):h("",!0),e(m).length?(g(),b(F,{key:1,onClick:e(pe)},{default:t(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):h("",!0),s(F,{onClick:a[8]||(a[8]=n=>C.value=!0)},{default:t(()=>[i(o(l.$t("history")),1)]),_:1})]),s(Re,{size:"large",spinning:!e(S).isIdle},{default:t(()=>[s(Ae,{visible:e(I),"onUpdate:visible":a[10]||(a[10]=n=>Z(I)?I.value=n:null),width:"70vw","mask-closable":"",onOk:a[11]||(a[11]=n=>I.value=!1)},{cancelText:t(()=>[]),default:t(()=>[s($e,{active:"",loading:!e(ie).isIdle},{default:t(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:a[9]||(a[9]=n=>e(Ge)(e(j)))},[u("div",St,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(j)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),E.value===0&&!e(m).length&&e(O).getRecords().length?(g(),A("div",Ct,[u("h2",xt,o(l.$t("restoreFromHistory")),1),s(se,{records:e(O),onReuseRecord:q},{default:t(({record:n})=>[u("div",It,[s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(g(),b(y,{key:0},{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):h("",!0),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),s(y,null,{default:t(()=>[s(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),s(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),$t])]),_:1},8,["records"])])):h("",!0),e(m)?(g(),b(e(tt),{key:1,ref_key:"scroller",ref:J,class:"file-list",items:e(m),"item-size":e(N).first,"key-field":"fullpath","item-secondary-size":e(N).second,gridItems:e(oe),onScroll:e(K)},{after:t(()=>[At]),default:t(({item:n,index:Q})=>[s(st,{idx:Q,file:n,"show-menu-idx":e(D),"onUpdate:showMenuIdx":a[12]||(a[12]=Oe=>Z(D)?D.value=Oe:null),onFileItemClick:e(re),"full-screen-preview-image-url":e(m)[e(x)]?e(Ne)(e(m)[e(x)]):"","cell-width":e(ce),selected:e(M).includes(Q),onContextMenuClick:e(H),onDragstart:e(de),onDragend:e(ue),"enable-change-indicator":e(ge),"seed-change-checked":e(me),"get-gen-diff":e(_e),"get-gen-diff-watch-dep":e(he),"is-selected-mutil-files":e(M).length>1,onPreviewVisibleChange:e(ne)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):h("",!0),e(P)?(g(),A("div",Rt,[s(e(lt),{onClick:a[13]||(a[13]=n=>e(T)("prev")),class:R({disable:!e(G)("prev")})},null,8,["class"]),s(e(nt),{onClick:a[14]||(a[14]=n=>e(T)("next")),class:R({disable:!e(G)("next")})},null,8,["class"])])):h("",!0)]),_:1},8,["spinning"]),e(P)&&e(m)&&e(m)[e(x)]?(g(),b(ot,{key:1,file:e(m)[e(x)],idx:e(x),onContextMenuClick:e(H)},null,8,["file","idx","onContextMenuClick"])):h("",!0)],512)],64)}}});const Lt=Ye(Ot,[["__scopeId","data-v-127e6fd2"]]);export{Lt as default};
